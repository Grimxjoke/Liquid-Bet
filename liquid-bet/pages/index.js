import Head from 'next/head'
import styles from '../styles/Home.module.css'
import TopMatch from '../components/TopMatch'
import Bets from '../components/Bets'
import {
  BRAZIL_TOKEN_ABI,
  BRAZIL_TOKEN_ADDRESS,
  FRANCE_TOKEN_ADDRESS,
  FRANCE_TOKEN_ABI,
  SWAP_CONTRACT_ADDRESS,
  SWAP_CONTRACT_ABI,

} from "../constants"


import { useContractWrite, usePrepareContractWrite } from 'wagmi';
import { useState, useRef } from 'react'



export default function Home() {






  /***
   * Approve Function on BRA Tokens
   */
  const { config: brazilApproveConfig } = usePrepareContractWrite({
    address: BRAZIL_TOKEN_ADDRESS,
    abi: BRAZIL_TOKEN_ABI,
    functionName: "approve",
    args: [SWAP_CONTRACT_ADDRESS, 10000000]
  })
  const { write: brazilWrite } = useContractWrite(brazilApproveConfig);


  /***
 * Approve Function on FRA Tokens
 */
  const { config: franceApproveConfig } = usePrepareContractWrite({
    address: FRANCE_TOKEN_ADDRESS,
    abi: FRANCE_TOKEN_ABI,
    functionName: "approve",
    args: [SWAP_CONTRACT_ADDRESS, 10000000],

  })
  const { write: franceWrite } = useContractWrite({
    ...franceApproveConfig,
    onSuccess() {
      disableApproveBtn()
    }
  })


  /***
 * Call Deposit Function on BRA Tokens
 * 
 * default value is 0.002 Matic
 */


  /**
   * Disable Approve button when transaction is succesful
   */
  const ref = useRef(null);
  const disableApproveBtn = () => {
    ref.current.hidden = true;
  }

  return (
    <div className={styles.container}>
      <Head>
        <title>Liquid bet</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <div>
        <button className={styles.approve} ref={ref} onClick={() => {
          brazilWrite()
          franceWrite()
        }}>
          Approve
        </button>

        <TopMatch />
        <Bets />

      </div>
    </div>
  )
}
